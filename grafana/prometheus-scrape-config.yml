# Prometheus Scrape Configuration for Shia Islamic Chatbot Queue System
# Add this to your existing Prometheus configuration

scrape_configs:
  # FastAPI Application (3 replicas behind NGINX)
  - job_name: 'fastapi-queue-system'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets:
          - 'shia-chatbot-app-1:8000'
          - 'shia-chatbot-app-2:8000'
          - 'shia-chatbot-app-3:8000'
        labels:
          service: 'fastapi'
          deployment: 'queue-system'
          instance_type: 'app-replica'

  # NGINX Load Balancer (if nginx-prometheus-exporter is configured)
  - job_name: 'nginx-load-balancer'
    scrape_interval: 15s
    static_configs:
      - targets:
          - 'shia-chatbot-nginx:9113'  # Requires nginx-prometheus-exporter
        labels:
          service: 'nginx'
          role: 'load-balancer'

  # Alternative: Direct FastAPI access via NGINX (port 8100)
  - job_name: 'fastapi-via-nginx'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets:
          - 'localhost:8100'  # NGINX frontend
        labels:
          service: 'fastapi'
          access: 'nginx-frontend'

# Relabeling rules for better organization
# Automatically add environment labels based on container metadata
relabel_configs:
  - source_labels: [__address__]
    target_label: __param_target
  - source_labels: [__param_target]
    target_label: instance
  - target_label: __address__
    replacement: localhost:9090  # Prometheus server address

# Alert Rules (optional - add to your alert rules file)
# groups:
