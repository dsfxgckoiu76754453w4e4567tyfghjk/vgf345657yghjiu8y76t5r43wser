# MinIO Object Storage - Docker Compose Configuration
#
# Usage:
#   docker-compose -f docker-compose.minio.yml up -d
#
# This file can be merged into your main docker-compose.yml or run separately.

version: '3.8'

services:
  minio:
    image: minio/minio:latest
    container_name: wisqu-minio
    restart: unless-stopped

    command: server /data --console-address ":9001"

    environment:
      # SECURITY: Change these in production!
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin}

      # Optional: Set region
      MINIO_REGION: ${MINIO_REGION:-us-east-1}

      # Optional: Browser redirect URL (for reverse proxy)
      # MINIO_BROWSER_REDIRECT_URL: https://minio.yourdomain.com

    volumes:
      # Persistent storage for MinIO data
      - minio-data:/data

    ports:
      # S3 API endpoint
      - "9000:9000"
      # Web Console (Admin UI)
      - "9001:9001"

    networks:
      - app-network

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '0.5'
          memory: 1G

volumes:
  minio-data:
    driver: local
    # Optional: Use bind mount for specific directory
    # driver_opts:
    #   type: none
    #   device: /path/to/minio/data
    #   o: bind

networks:
  app-network:
    driver: bridge
    # If you have an existing network, use:
    # external: true
    # name: your_existing_network_name
